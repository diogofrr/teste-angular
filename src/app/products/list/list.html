<div class="products-list-container">
  <p-card styleClass="full-height-card">
    <ng-template pTemplate="header">
      <p-toolbar styleClass="mb-4">
        <div class="p-toolbar-group-start">
          <h2 class="m-0">
            <i class="pi pi-box mr-2"></i>
            Lista de Produtos
          </h2>
        </div>
        <div class="p-toolbar-group-end">
          <p-button
            label="Novo Produto"
            icon="pi pi-plus"
            (onClick)="navigateToCreate()"
            [raised]="true"
            aria-label="Adicionar novo produto"
            type="button"
          ></p-button>
        </div>
      </p-toolbar>
    </ng-template>

    <div class="search-container">
      <label for="search-input" class="sr-only">Buscar produtos</label>
      <p-inputGroup>
        <p-inputGroupAddon>
          <i class="pi pi-search" aria-hidden="true"></i>
        </p-inputGroupAddon>
        <input
          id="search-input"
          type="text"
          pInputText
          placeholder="Buscar por nome, descrição ou categoria..."
          #searchInput
          [(ngModel)]="searchTerm"
          (ngModelChange)="filterProducts($event)"
          aria-label="Buscar produtos por nome, descrição ou categoria"
          aria-describedby="search-description"
        />
        <span id="search-description" class="sr-only"> Digite para buscar produtos na lista </span>
        @if (searchTerm) {
        <p-inputGroupAddon>
          <p-button
            icon="pi pi-times"
            [text]="true"
            severity="secondary"
            (onClick)="searchTerm = ''; filterProducts('')"
            pTooltip="Limpar busca"
            aria-label="Limpar busca"
            type="button"
          ></p-button>
        </p-inputGroupAddon>
        }
      </p-inputGroup>
    </div>

    <p-table
      [value]="filteredProducts"
      [loading]="loading"
      [paginator]="true"
      [rows]="10"
      [rowsPerPageOptions]="[5, 10, 20, 50]"
      [globalFilterFields]="['name', 'description', 'category']"
      styleClass="p-datatable-striped p-datatable-gridlines"
      [tableStyle]="{ 'min-width': '50rem' }"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} produtos"
      aria-label="Tabela de produtos"
    >
      <ng-template pTemplate="header">
        <tr>
          <th scope="col">Nome</th>
          <th scope="col">Descrição</th>
          <th scope="col">Categoria</th>
          <th scope="col">Preço</th>
          <th scope="col">Criado em</th>
          <th scope="col" style="width: 10rem">Ações</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-product>
        <tr>
          <td>{{ product.name }}</td>
          <td>
            @if (product.description.length > 100) {
            <span
              [pTooltip]="product.description"
              tooltipPosition="top"
              [showDelay]="300"
              [hideDelay]="0"
              style="cursor: help"
            >
              {{ truncateDescription(product.description, 100) }}
            </span>
            } @else {
            {{ product.description }}
            }
          </td>
          <td>
            <p-tag
              [value]="product.category"
              severity="info"
              [aria-label]="'Categoria: ' + product.category"
            ></p-tag>
          </td>
          <td>{{ formatPrice(product.price) }}</td>
          <td>
            <time [dateTime]="product.createdAt">{{ formatDate(product.createdAt) }}</time>
          </td>
          <td>
            <div class="actions" role="group" aria-label="Ações do produto">
              <p-button
                icon="pi pi-pencil"
                [rounded]="true"
                [text]="true"
                severity="info"
                (onClick)="navigateToEdit(product.id)"
                pTooltip="Editar produto"
                tooltipPosition="top"
                [aria-label]="'Editar produto ' + product.name"
                type="button"
              ></p-button>
              <p-button
                icon="pi pi-trash"
                [rounded]="true"
                [text]="true"
                severity="danger"
                (onClick)="confirmDelete(product)"
                pTooltip="Excluir produto"
                tooltipPosition="top"
                [aria-label]="'Excluir produto ' + product.name"
                type="button"
              ></p-button>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="6">
            <div class="empty-state">
              <i class="pi pi-inbox empty-icon"></i>
              <p class="empty-message">
                @if (products.length === 0) { Nenhum produto cadastrado ainda. } @else { Nenhum
                produto encontrado com os filtros aplicados. }
              </p>
              <p-button
                label="Adicionar Primeiro Produto"
                icon="pi pi-plus"
                (onClick)="navigateToCreate()"
                [outlined]="true"
                aria-label="Adicionar primeiro produto"
                type="button"
              ></p-button>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>

  <p-confirmDialog
    [style]="{ width: '30rem' }"
    [breakpoints]="{ '960px': '75vw', '640px': '90vw' }"
    [baseZIndex]="10000"
  ></p-confirmDialog>
</div>
