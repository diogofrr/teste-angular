<div class="products-list-container">
  <p-card styleClass="full-height-card">
    <ng-template pTemplate="header">
      <p-toolbar styleClass="mb-4">
        <div class="p-toolbar-group-start">
          <h2 class="m-0">
            <i class="pi pi-box mr-2"></i>
            Lista de Produtos
          </h2>
        </div>
        <div class="p-toolbar-group-end">
          <p-button
            label="Novo Produto"
            icon="pi pi-plus"
            (onClick)="navigateToCreate()"
            [raised]="true"
          ></p-button>
        </div>
      </p-toolbar>
    </ng-template>

    <div class="search-container">
      <p-inputGroup>
        <p-inputGroupAddon>
          <i class="pi pi-search"></i>
        </p-inputGroupAddon>
        <input
          type="text"
          pInputText
          placeholder="Buscar por nome, descrição ou categoria..."
          #searchInput
          (input)="filterProducts(searchInput.value)"
        />
        @if (searchInput.value) {
        <p-inputGroupAddon>
          <p-button
            icon="pi pi-times"
            [text]="true"
            severity="secondary"
            (onClick)="searchInput.value = ''; filterProducts('')"
            pTooltip="Limpar busca"
          ></p-button>
        </p-inputGroupAddon>
        }
      </p-inputGroup>
    </div>

    <p-table
      [value]="filteredProducts"
      [loading]="loading"
      [paginator]="true"
      [rows]="10"
      [rowsPerPageOptions]="[5, 10, 20, 50]"
      [globalFilterFields]="['name', 'description', 'category']"
      styleClass="p-datatable-striped p-datatable-gridlines"
      [tableStyle]="{ 'min-width': '50rem' }"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} produtos"
    >
      <ng-template pTemplate="header">
        <tr>
          <th>Nome</th>
          <th>Descrição</th>
          <th>Categoria</th>
          <th>Preço</th>
          <th>Criado em</th>
          <th style="width: 10rem">Ações</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-product>
        <tr>
          <td>{{ product.name }}</td>
          <td>{{ product.description }}</td>
          <td>
            <p-tag [value]="product.category" severity="info"></p-tag>
          </td>
          <td>{{ formatPrice(product.price) }}</td>
          <td>{{ formatDate(product.createdAt) }}</td>
          <td>
            <div class="actions">
              <p-button
                icon="pi pi-pencil"
                [rounded]="true"
                [text]="true"
                severity="info"
                (onClick)="navigateToEdit(product.id)"
                pTooltip="Editar"
                tooltipPosition="top"
              ></p-button>
              <p-button
                icon="pi pi-trash"
                [rounded]="true"
                [text]="true"
                severity="danger"
                (onClick)="confirmDelete(product)"
                pTooltip="Excluir"
                tooltipPosition="top"
              ></p-button>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="6">
            <div class="empty-state">
              <i class="pi pi-inbox empty-icon"></i>
              <p class="empty-message">
                @if (products.length === 0) { Nenhum produto cadastrado ainda. } @else { Nenhum
                produto encontrado com os filtros aplicados. }
              </p>
              <p-button
                label="Adicionar Primeiro Produto"
                icon="pi pi-plus"
                (onClick)="navigateToCreate()"
                [outlined]="true"
              ></p-button>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>

  <p-confirmDialog
    [style]="{ width: '30rem' }"
    [breakpoints]="{ '960px': '75vw', '640px': '90vw' }"
    [baseZIndex]="10000"
  ></p-confirmDialog>
</div>
